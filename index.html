<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>MovieStream · user panel</title>
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* Your existing styles remain exactly the same */
    /* ... (keep all your existing CSS) ... */
  </style>
</head>
<body>
  <!-- ============ FIREBASE SDK ============ -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  
  <!-- ============ YOUR EXISTING HTML STRUCTURE ============ -->
  <!-- Keep all your HTML structure exactly as is -->
  <!-- ... (all screens, navigation, modals) ... -->

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAwTb4dwTnLNwUZ_v37ht4xLL_buNOe96Q",
      authDomain: "mymovieapp-b088c.firebaseapp.com",
      projectId: "mymovieapp-b088c",
      storageBucket: "mymovieapp-b088c.firebasestorage.app",
      messagingSenderId: "243642474836",
      appId: "1:243642474836:web:69071fcd8b2ec9bd97a8c1"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();
    const provider = new firebase.auth.GoogleAuthProvider();

    // ==================== GLOBAL STATE ====================
    let currentUser = null;
    let allMovies = []; // Store all movies from Firebase
    let filteredMovies = [];

    // ==================== SCREEN NAVIGATION ====================
    const screens = ['homeScreen', 'searchScreen', 'myListScreen', 'profileScreen', 'detailScreen'];
    const navItems = ['navHome', 'navSearch', 'navMyList', 'navProfile'];

    function switchScreen(screenId) {
      screens.forEach(id => document.getElementById(id).classList.remove('active'));
      document.getElementById(screenId).classList.add('active');
      
      if (screenId === 'homeScreen') setActiveNav('navHome');
      else if (screenId === 'searchScreen') setActiveNav('navSearch');
      else if (screenId === 'myListScreen') setActiveNav('navMyList');
      else if (screenId === 'profileScreen') setActiveNav('navProfile');
      
      // Refresh content when switching screens
      if (screenId === 'homeScreen') {
        loadMoviesToHome();
        startBannerRotation();
      }
      if (screenId === 'myListScreen') renderMyListScreen();
      if (screenId === 'profileScreen') renderProfileScreen();
    }

    function setActiveNav(activeId) {
      navItems.forEach(id => document.getElementById(id)?.classList.remove('active'));
      if (activeId) document.getElementById(activeId)?.classList.add('active');
    }

    // ==================== LOAD MOVIES FROM FIREBASE ====================
    function loadMoviesFromFirebase() {
      const moviesRef = database.ref('movies');
      
      moviesRef.on('value', (snapshot) => {
        if (snapshot.exists()) {
          allMovies = [];
          snapshot.forEach((childSnapshot) => {
            const movie = childSnapshot.val();
            movie.id = childSnapshot.key;
            allMovies.push(movie);
          });
          
          console.log(`Loaded ${allMovies.length} movies from Firebase`);
          
          // Update UI based on current screen
          if (document.getElementById('homeScreen').classList.contains('active')) {
            loadMoviesToHome();
          }
          
          // Update search if active
          if (document.getElementById('searchScreen').classList.contains('active')) {
            // Search will be handled by input
          }
          
          // Update banner with actual movies
          updateBannerWithMovies();
          
        } else {
          console.log('No movies found in Firebase');
          allMovies = [];
          showEmptyStates();
        }
      }, (error) => {
        console.error('Error loading movies:', error);
        showToast('Failed to load movies. Please check your connection.', 'error');
      });
    }

    // ==================== LOAD MOVIES TO HOME SCREEN ROWS ====================
    function loadMoviesToHome() {
      if (allMovies.length === 0) {
        // Show empty placeholders
        createEmptyRows();
        return;
      }

      // Sort movies by upload date (newest first)
      const sortedMovies = [...allMovies].sort((a, b) => 
        (b.uploadDate || b.createdAt || 0) - (a.uploadDate || a.createdAt || 0)
      );

      // Populate rows based on categories
      const rows = [
        { id: 'row1', title: 'Continue Watching', filter: () => sortedMovies.slice(0, 10) }, // Recently added as "Continue Watching"
        { id: 'row2', title: 'Trending Now', filter: () => sortedMovies.sort((a, b) => (b.views || 0) - (a.views || 0)).slice(0, 10) },
        { id: 'row3', title: 'New Releases', filter: () => sortedMovies.slice(0, 10) },
        { id: 'row4', title: 'Popular Movies', filter: () => sortedMovies.sort((a, b) => (b.views || 0) - (a.views || 0)).slice(0, 10) },
        { id: 'row5', title: 'Top Rated', filter: () => sortedMovies.sort((a, b) => (b.rating || 0) - (a.rating || 0)).slice(0, 10) },
        { id: 'row6', title: 'Action Movies', filter: () => sortedMovies.filter(m => m.genre === 'Action').slice(0, 10) },
        { id: 'row7', title: 'Drama Movies', filter: () => sortedMovies.filter(m => m.genre === 'Drama').slice(0, 10) },
        { id: 'row8', title: 'Comedy Movies', filter: () => sortedMovies.filter(m => m.genre === 'Comedy').slice(0, 10) },
        { id: 'row9', title: 'Horror Movies', filter: () => sortedMovies.filter(m => m.genre === 'Horror').slice(0, 10) }
      ];

      rows.forEach(row => {
        const container = document.getElementById(row.id);
        if (!container) return;
        
        container.innerHTML = ''; // Clear existing content
        
        const movies = row.filter();
        
        if (movies.length === 0) {
          // Show placeholder if no movies for this category
          for (let i = 0; i < 5; i++) {
            container.appendChild(createPlaceholderCard());
          }
        } else {
          // Show actual movie cards
          movies.forEach(movie => {
            container.appendChild(createMovieCard(movie));
          });
        }
      });
    }

    function createMovieCard(movie) {
      const card = document.createElement('div');
      card.className = 'card-placeholder';
      card.style.backgroundImage = `url(${movie.posterUrl || 'https://via.placeholder.com/300x450?text=No+Poster'})`;
      card.style.backgroundSize = 'cover';
      card.style.backgroundPosition = 'center';
      card.style.position = 'relative';
      
      // Add title overlay
      const titleOverlay = document.createElement('div');
      titleOverlay.style.position = 'absolute';
      titleOverlay.style.bottom = '0';
      titleOverlay.style.left = '0';
      titleOverlay.style.right = '0';
      titleOverlay.style.padding = '8px';
      titleOverlay.style.background = 'linear-gradient(transparent, rgba(0,0,0,0.9))';
      titleOverlay.style.color = 'white';
      titleOverlay.style.fontSize = '0.8rem';
      titleOverlay.style.fontWeight = '600';
      titleOverlay.style.borderRadius = '0 0 12px 12px';
      titleOverlay.textContent = movie.title;
      
      card.appendChild(titleOverlay);
      
      card.addEventListener('click', () => {
        showMovieDetails(movie);
      });
      
      return card;
    }

    function createPlaceholderCard() {
      const card = document.createElement('div');
      card.className = 'card-placeholder';
      card.style.backgroundColor = '#1f1f1f';
      card.style.backgroundImage = 'none';
      card.addEventListener('click', () => {
        showToast('No movie available', 'info');
      });
      return card;
    }

    function createEmptyRows() {
      const rows = ['row1','row2','row3','row4','row5','row6','row7','row8','row9'];
      rows.forEach(rowId => {
        const container = document.getElementById(rowId);
        if (container) {
          container.innerHTML = '';
          for (let i = 0; i < 8; i++) {
            container.appendChild(createPlaceholderCard());
          }
        }
      });
    }

    // ==================== SHOW MOVIE DETAILS ====================
    function showMovieDetails(movie) {
      // Switch to detail screen
      switchScreen('detailScreen');
      
      // Populate detail screen with movie data
      const detailScreen = document.getElementById('detailScreen');
      
      // Update view count in Firebase
      const movieRef = database.ref(`movies/${movie.id}`);
      movieRef.update({
        views: (movie.views || 0) + 1
      });
      
      // Create detailed view
      detailScreen.innerHTML = `
        <div class="app-header">
          <span class="logo" style="font-size:1.6rem;">${movie.title}</span>
          <i class="fas fa-arrow-left icon-btn" onclick="switchScreen('homeScreen');"></i>
        </div>
        
        <div class="detail-poster-block" style="background-image: url(${movie.posterUrl}); background-size: cover; background-position: center;"></div>
        
        <h2 style="margin: 20px 0 10px;">${movie.title}</h2>
        
        <div style="display: flex; gap: 15px; margin-bottom: 15px; color: #aaa;">
          <span><i class="fas fa-calendar"></i> ${movie.year || '2024'}</span>
          <span><i class="fas fa-clock"></i> ${movie.duration || '120'} min</span>
          <span><i class="fas fa-star"></i> ${movie.rating || '0'}/10</span>
        </div>
        
        <div style="margin-bottom: 15px;">
          <span class="movie-genre" style="background: #e50914; padding: 5px 12px; border-radius: 20px; color: white;">${movie.genre}</span>
        </div>
        
        <p style="color: #ddd; line-height: 1.6; margin-bottom: 25px;">${movie.description}</p>
        
        <div class="button-row">
          <button class="btn-google" style="flex: 2;" onclick="playMovie('${movie.movieUrl}')">
            <i class="fas fa-play"></i> Play Now
          </button>
          <button class="btn-later" style="flex: 1;" onclick="handleProtectedAction('add', '${movie.id}')">
            <i class="fas fa-plus"></i>
          </button>
        </div>
        
        ${movie.trailerUrl ? `
          <div style="margin-top: 30px;">
            <h3 style="margin-bottom: 15px;">Trailer</h3>
            <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 12px;">
              <iframe src="${convertToEmbedUrl(movie.trailerUrl)}" 
                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"
                allowfullscreen>
              </iframe>
            </div>
          </div>
        ` : ''}
      `;
    }

    function playMovie(url) {
      if (!url) {
        showToast('Movie URL not available', 'error');
        return;
      }
      
      // Open in new tab or create video player
      window.open(url, '_blank');
    }

    // ==================== SEARCH FUNCTIONALITY ====================
    document.getElementById('searchField')?.addEventListener('input', function(e) {
      const searchTerm = e.target.value.toLowerCase().trim();
      const placeholder = document.getElementById('searchResultPlaceholder');
      const categoriesGrid = document.querySelector('.categories-grid');
      
      if (searchTerm.length > 0) {
        // Hide categories, show search results
        categoriesGrid.style.display = 'none';
        placeholder.style.display = 'block';
        
        // Search in movies
        const results = allMovies.filter(movie => 
          movie.title.toLowerCase().includes(searchTerm) ||
          movie.genre.toLowerCase().includes(searchTerm) ||
          (movie.description && movie.description.toLowerCase().includes(searchTerm))
        );
        
        if (results.length > 0) {
          document.getElementById('emptyResultText').innerHTML = `
            Found ${results.length} result${results.length > 1 ? 's' : ''} for "${e.target.value}"
            <div style="margin-top: 20px; display: flex; flex-direction: column; gap: 10px;">
              ${results.map(movie => `
                <div onclick="showMovieDetails(${JSON.stringify(movie).replace(/"/g, '&quot;')})" 
                     style="background: #2a2a2a; padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 10px;">
                  <img src="${movie.posterUrl}" style="width: 50px; height: 70px; object-fit: cover; border-radius: 4px;" onerror="this.src='https://via.placeholder.com/50x70'">
                  <div style="text-align: left;">
                    <div style="font-weight: 600;">${movie.title}</div>
                    <div style="font-size: 0.8rem; color: #aaa;">${movie.genre} · ${movie.year || '2024'}</div>
                  </div>
                </div>
              `).join('')}
            </div>
          `;
        } else {
          document.getElementById('emptyResultText').innerHTML = `No results found for "${e.target.value}"`;
        }
      } else {
        // Show categories, hide results
        categoriesGrid.style.display = 'flex';
        placeholder.style.display = 'none';
      }
    });

    window.showEmptySearchResult = function(category) {
      const placeholderDiv = document.getElementById('searchResultPlaceholder');
      const categoriesGrid = document.querySelector('.categories-grid');
      
      categoriesGrid.style.display = 'none';
      placeholderDiv.style.display = 'block';
      
      // Filter movies by category
      const results = allMovies.filter(movie => movie.genre === category);
      
      if (results.length > 0) {
        document.getElementById('emptyResultText').innerHTML = `
          <div style="margin-bottom: 15px;">${category} Movies (${results.length})</div>
          <div style="display: flex; flex-direction: column; gap: 10px;">
            ${results.map(movie => `
              <div onclick="showMovieDetails(${JSON.stringify(movie).replace(/"/g, '&quot;')})" 
                   style="background: #2a2a2a; padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 10px;">
                <img src="${movie.posterUrl}" style="width: 50px; height: 70px; object-fit: cover; border-radius: 4px;" onerror="this.src='https://via.placeholder.com/50x70'">
                <div style="text-align: left;">
                  <div style="font-weight: 600;">${movie.title}</div>
                  <div style="font-size: 0.8rem; color: #aaa;">${movie.year || '2024'}</div>
                </div>
              </div>
            `).join('')}
          </div>
        `;
      } else {
        document.getElementById('emptyResultText').innerHTML = `No ${category} movies available yet`;
      }
    };

    // ==================== BANNER WITH MOVIES ====================
    let bannerInterval;
    let currentBannerIndex = 0;

    function updateBannerWithMovies() {
      const bannerEl = document.getElementById('bannerSlot');
      const dotsContainer = document.getElementById('bannerDots');
      
      if (!bannerEl || !dotsContainer) return;
      
      // Get movies with banner images
      const moviesWithBanner = allMovies.filter(m => m.bannerUrl || m.posterUrl);
      
      if (moviesWithBanner.length === 0) {
        bannerEl.innerHTML = '<div class="banner-placeholder">Featured movies will appear here</div>';
        dotsContainer.innerHTML = '<span class="dot active-dot"></span>';
        return;
      }
      
      // Create banner HTML
      const bannerMovies = moviesWithBanner.slice(0, 5);
      
      // Create dots
      dotsContainer.innerHTML = bannerMovies.map((_, i) => 
        `<span class="dot ${i === 0 ? 'active-dot' : ''}" onclick="setBannerIndex(${i})"></span>`
      ).join('');
      
      // Show first banner
      showBannerAtIndex(0, bannerMovies);
      
      // Clear existing interval
      if (bannerInterval) clearInterval(bannerInterval);
      
      // Start auto rotation
      bannerInterval = setInterval(() => {
        currentBannerIndex = (currentBannerIndex + 1) % bannerMovies.length;
        showBannerAtIndex(currentBannerIndex, bannerMovies);
      }, 5000);
    }

    function showBannerAtIndex(index, movies) {
      const bannerEl = document.getElementById('bannerSlot');
      const movie = movies[index];
      
      bannerEl.innerHTML = `
        <div style="width: 100%; height: 100%; background-image: url(${movie.bannerUrl || movie.posterUrl}); background-size: cover; background-position: center; display: flex; align-items: flex-end; padding: 20px; cursor: pointer;" onclick="showMovieDetails(${JSON.stringify(movie).replace(/"/g, '&quot;')})">
          <div style="background: linear-gradient(transparent, rgba(0,0,0,0.8)); padding: 20px; width: 100%; border-radius: 0 0 12px 12px;">
            <h3 style="color: white; margin-bottom: 5px;">${movie.title}</h3>
            <p style="color: #ddd; font-size: 0.9rem;">${movie.genre} · ${movie.year || '2024'}</p>
          </div>
        </div>
      `;
      
      // Update dots
      document.querySelectorAll('.dot').forEach((dot, i) => {
        dot.classList.toggle('active-dot', i === index);
      });
      
      currentBannerIndex = index;
    }

    function setBannerIndex(index) {
      const moviesWithBanner = allMovies.filter(m => m.bannerUrl || m.posterUrl).slice(0, 5);
      showBannerAtIndex(index, moviesWithBanner);
    }

    function startBannerRotation() {
      // Banner rotation is handled in updateBannerWithMovies
    }

    // ==================== UTILITY FUNCTIONS ====================
    function convertToEmbedUrl(url) {
      if (!url) return '';
      
      // YouTube
      if (url.includes('youtube.com/watch?v=')) {
        const videoId = url.split('v=')[1].split('&')[0];
        return `https://www.youtube.com/embed/${videoId}`;
      } else if (url.includes('youtu.be/')) {
        const videoId = url.split('youtu.be/')[1].split('?')[0];
        return `https://www.youtube.com/embed/${videoId}`;
      }
      // Vimeo
      else if (url.includes('vimeo.com/')) {
        const videoId = url.split('vimeo.com/')[1].split('?')[0];
        return `https://player.vimeo.com/video/${videoId}`;
      }
      // Default - return as is
      return url;
    }

    function showToast(message, type = 'info') {
      // Create toast element
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%);
        background: ${type === 'error' ? '#e50914' : '#2a2a2a'};
        color: white;
        padding: 12px 24px;
        border-radius: 30px;
        z-index: 9999;
        font-weight: 500;
        box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        animation: slideUp 0.3s ease;
      `;
      toast.textContent = message;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = 'fadeOut 0.3s ease';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function showEmptyStates() {
      createEmptyRows();
    }

    // ==================== AUTHENTICATION FUNCTIONS ====================
    window.handleProtectedAction = function(action, movieId) {
      if (!currentUser) {
        document.getElementById('loginModal').classList.add('active');
      } else {
        if (action === 'add' && movieId) {
          addToMyList(movieId);
        } else {
          showToast(`Demo: ${action} action`, 'info');
        }
      }
    };

    async function addToMyList(movieId) {
      if (!currentUser) return;
      
      const movie = allMovies.find(m => m.id === movieId);
      if (!movie) return;
      
      const userListRef = database.ref(`users/${currentUser.uid}/myList/${movieId}`);
      
      try {
        await userListRef.set({
          id: movieId,
          title: movie.title,
          posterUrl: movie.posterUrl,
          genre: movie.genre,
          addedAt: Date.now()
        });
        showToast('Added to My List', 'success');
      } catch (error) {
        console.error('Error adding to list:', error);
        showToast('Failed to add to list', 'error');
      }
    }

    // ==================== MY LIST SCREEN ====================
    async function renderMyListScreen() {
      const container = document.getElementById('myListContent');
      if (!container) return;

      if (!currentUser) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon"><i class="fas fa-bookmark"></i></div>
            <h3 style="font-weight: 400; margin-bottom: 12px;">Sign in to see your saved movies</h3>
            <button class="btn-google"><i class="fab fa-google"></i> Continue with Google</button>
          </div>
        `;
      } else {
        // Load user's list from Firebase
        const userListRef = database.ref(`users/${currentUser.uid}/myList`);
        const snapshot = await userListRef.once('value');
        
        if (snapshot.exists()) {
          const listItems = [];
          snapshot.forEach(child => {
            listItems.push(child.val());
          });
          
          if (listItems.length > 0) {
            container.innerHTML = `
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px;">
                ${listItems.map(item => `
                  <div onclick="showMovieDetails(${JSON.stringify(item).replace(/"/g, '&quot;')})" 
                       style="background: #1f1f1f; border-radius: 12px; overflow: hidden; cursor: pointer;">
                    <img src="${item.posterUrl}" style="width: 100%; height: 150px; object-fit: cover;">
                    <div style="padding: 10px;">
                      <div style="font-weight: 600; font-size: 0.9rem;">${item.title}</div>
                      <div style="font-size: 0.75rem; color: #aaa;">${item.genre}</div>
                    </div>
                  </div>
                `).join('')}
              </div>
            `;
          } else {
            container.innerHTML = `
              <div class="empty-state">
                <div class="empty-icon"><i class="fas fa-list"></i></div>
                <h3 style="font-weight: 400;">Your list is empty</h3>
                <button class="btn-google" onclick="switchScreen('homeScreen')">Browse Movies</button>
              </div>
            `;
          }
        } else {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon"><i class="fas fa-list"></i></div>
              <h3 style="font-weight: 400;">Your list is empty</h3>
              <button class="btn-google" onclick="switchScreen('homeScreen')">Browse Movies</button>
            </div>
          `;
        }
      }
    }

    // ==================== PROFILE SCREEN ====================
    function renderProfileScreen() {
      const container = document.getElementById('profileContent');
      if (!container) return;

      if (!currentUser) {
        container.innerHTML = `
          <div class="profile-guest">
            <div class="profile-icon"><i class="fas fa-user-circle"></i></div>
            <h2 style="font-size:1.6rem; margin-bottom: 8px;">Guest</h2>
            <p class="text-muted" style="margin-bottom: 16px;">Sign in to access all features</p>
            <button class="btn-google"><i class="fab fa-google"></i> Continue with Google</button>
          </div>
        `;
      } else {
        const photoURL = currentUser.photoURL || '';
        const displayName = currentUser.displayName || 'User';
        const email = currentUser.email || '';

        container.innerHTML = `
          <div class="profile-guest" style="padding: 32px 20px;">
            ${photoURL ? 
              `<img src="${photoURL}" alt="avatar" class="profile-avatar">` : 
              `<div class="profile-icon"><i class="fas fa-user-circle"></i></div>`
            }
            <h2 class="profile-user-name">${displayName}</h2>
            <p class="profile-user-email">${email}</p>
            <p style="margin-bottom: 20px; color: #b0b0b0;">Signed in successfully</p>
            <button class="btn-google" style="background: #2a2a2a; border:1px solid #555;" id="signOutBtn">
              <i class="fas fa-sign-out-alt"></i> Sign Out
            </button>
          </div>
        `;

        const signOutBtn = document.getElementById('signOutBtn');
        if (signOutBtn) {
          signOutBtn.addEventListener('click', async () => {
            try {
              await auth.signOut();
            } catch (err) {
              console.error('Sign out error', err);
            }
          });
        }
      }
    }

    // ==================== GOOGLE SIGN IN ====================
    async function signInWithGoogle() {
      try {
        const result = await auth.signInWithPopup(provider);
        currentUser = result.user;
        console.log('Login success:', currentUser.displayName);
        
        closeLoginModal();
        renderMyListScreen();
        renderProfileScreen();
        showToast(`Welcome ${currentUser.displayName || 'User'}!`, 'success');
      } catch (error) {
        console.error('Google Sign-In error:', error);
        showToast('Sign-in failed. Please try again.', 'error');
      }
    }

    document.getElementById('googleSignInBtn')?.addEventListener('click', (e) => {
      e.preventDefault();
      signInWithGoogle();
    });

    document.body.addEventListener('click', function(e) {
      const btn = e.target.closest('.btn-google');
      if (btn && btn.id !== 'googleSignInBtn') {
        e.preventDefault();
        if (!currentUser) {
          signInWithGoogle();
        }
      }
    });

    // ==================== AUTH STATE CHANGE ====================
    auth.onAuthStateChanged((user) => {
      currentUser = user;
      if (user) {
        console.log('Logged in as:', user.displayName);
      } else {
        console.log('Guest mode');
      }
      renderMyListScreen();
      renderProfileScreen();
    });

    // ==================== LOGIN MODAL ====================
    const modal = document.getElementById('loginModal');
    
    window.closeLoginModal = function() { 
      modal.classList.remove('active'); 
    };

    modal?.addEventListener('click', function(e) {
      if (e.target === modal) closeLoginModal();
    });

    // ==================== INITIALIZATION ====================
    document.addEventListener('DOMContentLoaded', () => {
      console.log('User panel initializing...');
      
      // Load movies from Firebase
      loadMoviesFromFirebase();
      
      // Initial renders
      renderMyListScreen();
      renderProfileScreen();
      
      // Set up search placeholder
      const searchPlaceholder = document.getElementById('searchResultPlaceholder');
      if (searchPlaceholder) {
        searchPlaceholder.style.display = 'none';
      }
    });

    // Add CSS animations
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeOut {
        from { opacity: 1; transform: translateX(-50%) translateY(0); }
        to { opacity: 0; transform: translateX(-50%) translateY(10px); }
      }
    `;
    document.head.appendChild(style);

  </script>
</body>
</html>
