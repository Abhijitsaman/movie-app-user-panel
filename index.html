<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MovieBox - Netflix Style Streaming</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* ===== RESET & BASE STYLES ===== */
        :root {
            /* Netflix Color Palette */
            --netflix-black: #141414;
            --netflix-dark: #181818;
            --netflix-card: #2a2a2a;
            --netflix-gray: #404040;
            --netflix-light-gray: #8c8c8c;
            --netflix-white: #e5e5e5;
            --netflix-red: #e50914;
            --netflix-blue: #0071eb;
            --netflix-green: #46d369;
            
            /* Theme Variables */
            --bg-primary: var(--netflix-black);
            --bg-secondary: var(--netflix-dark);
            --bg-card: var(--netflix-card);
            --bg-input: #333333;
            --accent: var(--netflix-red);
            --accent-light: #ff3b30;
            --text-primary: var(--netflix-white);
            --text-secondary: #999999;
            --text-muted: var(--netflix-light-gray);
            --border-color: var(--netflix-gray);
            
            /* Gradients */
            --gradient-dark: linear-gradient(to top, rgba(20, 20, 20, 0.95) 0%, rgba(20, 20, 20, 0.85) 30%, rgba(20, 20, 20, 0.7) 50%, transparent 100%);
            --gradient-light: linear-gradient(to top, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.7) 50%, transparent 100%);
            
            /* Shadows */
            --shadow-netflix: 0 0.5rem 1rem rgba(0, 0, 0, 0.5);
            --shadow-card: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.3);
            --shadow-elevated: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.7);
            
            /* Transitions */
            --transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Layout */
            --header-height: 70px;
            --nav-height: 60px;
            --carousel-height: 380px;
            --card-width: 200px;
            --card-height: 300px;
            --border-radius: 4px;
            --border-radius-lg: 8px;
        }

        .light-theme {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --bg-input: #ffffff;
            --text-primary: #181818;
            --text-secondary: #5a5a5a;
            --text-muted: #8c8c8c;
            --border-color: #e0e0e0;
            --shadow-netflix: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
            --shadow-card: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.08);
            --shadow-elevated: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Netflix Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            overflow-x: hidden;
            transition: background-color var(--transition-normal);
        }

        /* Hide scrollbar but keep functionality */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-light);
        }

        /* ===== LOADING SCREEN ===== */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-primary);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity var(--transition-normal);
        }

        .loading-logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
            animation: pulse 2s infinite;
        }

        .loading-logo i {
            font-size: 48px;
            color: var(--accent);
        }

        .loading-logo span {
            font-size: 36px;
            font-weight: 900;
            letter-spacing: 2px;
            color: var(--accent);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid transparent;
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            margin-top: 20px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===== HEADER ===== */
        .main-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.9) 0%, transparent 100%);
            display: flex;
            align-items: center;
            padding: 0 4%;
            z-index: 1000;
            transition: background-color var(--transition-normal), transform var(--transition-normal);
        }

        .header-scrolled {
            background-color: var(--bg-primary);
            box-shadow: var(--shadow-netflix);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 900;
            font-size: 28px;
            letter-spacing: 1px;
            color: var(--accent);
            text-decoration: none;
            margin-right: 40px;
        }

        .logo i {
            font-size: 32px;
        }

        .search-container {
            flex: 1;
            max-width: 600px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 50px 12px 20px;
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            color: var(--text-primary);
            font-size: 16px;
            transition: all var(--transition-fast);
        }

        .search-input:focus {
            outline: none;
            background-color: rgba(0, 0, 0, 0.9);
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(229, 9, 20, 0.3);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 18px;
            pointer-events: none;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-left: auto;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background-color var(--transition-fast);
        }

        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 4px;
            background: linear-gradient(45deg, var(--accent), var(--netflix-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform var(--transition-fast);
        }

        .user-avatar:hover {
            transform: scale(1.1);
        }

        /* ===== 3D CAROUSEL ===== */
        .carousel-section {
            padding: 0 4%;
            margin-top: calc(var(--header-height) + 20px);
            margin-bottom: 40px;
        }

        .carousel-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .carousel-container {
            position: relative;
            height: var(--carousel-height);
            perspective: 1200px;
            overflow: hidden;
            border-radius: var(--border-radius-lg);
        }

        .carousel-track {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform var(--transition-slow);
        }

        .carousel-item {
            position: absolute;
            width: 60%;
            height: 100%;
            top: 0;
            left: 50%;
            transform: translateX(-50%) rotateY(0deg) translateZ(0px);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            cursor: pointer;
            transition: all var(--transition-normal);
            opacity: 0.5;
            filter: brightness(0.5);
        }

        .carousel-item.active {
            opacity: 1;
            filter: brightness(1);
            z-index: 3;
            transform: translateX(-50%) rotateY(0deg) translateZ(100px);
            box-shadow: var(--shadow-elevated);
        }

        .carousel-item.left-1 {
            transform: translateX(-80%) rotateY(30deg) translateZ(50px);
            opacity: 0.8;
            filter: brightness(0.7);
            z-index: 2;
        }

        .carousel-item.left-2 {
            transform: translateX(-110%) rotateY(45deg) translateZ(0px);
            opacity: 0.6;
            filter: brightness(0.6);
            z-index: 1;
        }

        .carousel-item.right-1 {
            transform: translateX(-20%) rotateY(-30deg) translateZ(50px);
            opacity: 0.8;
            filter: brightness(0.7);
            z-index: 2;
        }

        .carousel-item.right-2 {
            transform: translateX(10%) rotateY(-45deg) translateZ(0px);
            opacity: 0.6;
            filter: brightness(0.6);
            z-index: 1;
        }

        .carousel-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-normal);
        }

        .carousel-item:hover .carousel-image {
            transform: scale(1.05);
        }

        .carousel-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 40px;
            background: var(--gradient-dark);
            color: white;
            transform: translateY(20px);
            opacity: 0;
            transition: all var(--transition-normal);
        }

        .carousel-item.active .carousel-overlay {
            transform: translateY(0);
            opacity: 1;
        }

        .carousel-title {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 10px;
        }

        .carousel-description {
            font-size: 14px;
            margin-bottom: 20px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .carousel-controls {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 5;
            pointer-events: none;
        }

        .carousel-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.7);
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            pointer-events: all;
        }

        .carousel-btn:hover {
            background-color: var(--accent);
            transform: scale(1.1);
        }

        .carousel-indicators {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }

        .carousel-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .carousel-indicator.active {
            background-color: var(--accent);
            transform: scale(1.2);
        }

        /* ===== GENRE FILTERS ===== */
        .genre-section {
            padding: 0 4%;
            margin-bottom: 40px;
        }

        .genre-container {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding: 10px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .genre-container::-webkit-scrollbar {
            display: none;
        }

        .genre-chip {
            padding: 8px 24px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all var(--transition-fast);
            flex-shrink: 0;
        }

        .genre-chip:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .genre-chip.active {
            background-color: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        /* ===== MOVIES GRID ===== */
        .movies-section {
            padding: 0 4%;
            margin-bottom: 80px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }

        @media (max-width: 768px) {
            .movies-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }

        @media (max-width: 480px) {
            .movies-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .movie-card {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            background-color: var(--bg-card);
            transition: all var(--transition-normal);
            cursor: pointer;
            aspect-ratio: 2/3;
            transform-origin: center bottom;
        }

        .movie-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: var(--shadow-elevated);
            z-index: 10;
        }

        .movie-poster {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-normal);
        }

        .movie-card:hover .movie-poster {
            transform: scale(1.1);
        }

        .movie-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9) 0%, transparent 50%);
            padding: 15px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            opacity: 0;
            transition: opacity var(--transition-normal);
        }

        .movie-card:hover .movie-overlay {
            opacity: 1;
        }

        .movie-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 5px;
            color: white;
        }

        .movie-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .movie-rating {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .movie-rating i {
            color: #ffd700;
            font-size: 12px;
        }

        .movie-genre-tag {
            display: inline-block;
            padding: 2px 8px;
            background-color: var(--accent);
            border-radius: 12px;
            font-size: 10px;
            color: white;
            margin-top: 8px;
        }

        /* ===== MOVIE DETAIL MODAL ===== */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-normal);
            padding: 20px;
        }

        .modal-backdrop.active {
            opacity: 1;
            pointer-events: all;
        }

        .movie-modal {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow: hidden;
            position: relative;
            animation: modalIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.7);
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            z-index: 10;
            transition: all var(--transition-fast);
        }

        .modal-close:hover {
            background-color: var(--accent);
            transform: rotate(90deg);
        }

        .modal-content {
            display: flex;
            flex-direction: column;
        }

        .modal-hero {
            position: relative;
            height: 300px;
            overflow: hidden;
        }

        .modal-backdrop-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.4);
        }

        .modal-hero-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 40px;
            background: linear-gradient(to top, var(--bg-secondary) 0%, transparent 100%);
        }

        .modal-title {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 10px;
            color: white;
        }

        .modal-meta {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.8);
        }

        .modal-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #ffd700;
        }

        .modal-body {
            padding: 40px;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 40px;
        }

        @media (max-width: 768px) {
            .modal-body {
                grid-template-columns: 1fr;
                padding: 20px;
            }
        }

        .modal-description {
            font-size: 16px;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .modal-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 30px;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .play-btn {
            background-color: var(--accent);
            color: white;
        }

        .play-btn:hover {
            background-color: var(--accent-light);
            transform: scale(1.05);
        }

        .download-btn {
            background-color: var(--netflix-green);
            color: white;
        }

        .download-btn:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }

        .favorite-btn {
            background-color: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: var(--text-primary);
        }

        .favorite-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .favorite-btn.favorited {
            background-color: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .report-btn {
            background-color: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: var(--text-primary);
        }

        .report-btn:hover {
            border-color: #ffd700;
            color: #ffd700;
        }

        .modal-sidebar {
            background-color: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 20px;
        }

        .info-item {
            margin-bottom: 20px;
        }

        .info-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-value {
            font-size: 16px;
            color: var(--text-primary);
        }

        .rating-section {
            margin-top: 30px;
        }

        .rating-title {
            font-size: 18px;
            margin-bottom: 15px;
        }

        .star-rating {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .star {
            font-size: 24px;
            color: #444;
            cursor: pointer;
            transition: color var(--transition-fast);
        }

        .star.active {
            color: #ffd700;
        }

        .star:hover,
        .star:hover ~ .star {
            color: #ffd700;
        }

        /* ===== VIDEO PLAYER MODAL ===== */
        .video-modal {
            background-color: #000;
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 1200px;
            max-height: 90vh;
            overflow: hidden;
            position: relative;
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            background-color: #000;
        }

        .video-iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-close {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
        }

        /* ===== SETTINGS MODAL ===== */
        .settings-modal {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .settings-header {
            padding: 30px;
            background-color: var(--bg-card);
            text-align: center;
        }

        .settings-title {
            font-size: 28px;
            font-weight: 900;
            margin-bottom: 10px;
        }

        .settings-subtitle {
            color: var(--text-secondary);
        }

        .settings-content {
            padding: 30px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-info {
            flex: 1;
        }

        .settings-label {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .settings-description {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background-color: var(--border-color);
            border-radius: 13px;
            cursor: pointer;
            transition: background-color var(--transition-fast);
        }

        .toggle-switch.active {
            background-color: var(--accent);
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: transform var(--transition-fast);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }

        .settings-actions {
            padding: 20px 30px 30px;
            display: flex;
            gap: 15px;
        }

        /* ===== BOTTOM NAVIGATION ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--nav-height);
            background-color: var(--bg-secondary);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
            border-top: 1px solid var(--border-color);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            text-decoration: none;
            color: var(--text-secondary);
            transition: all var(--transition-fast);
            padding: 10px;
            border-radius: var(--border-radius);
        }

        .nav-item:hover {
            color: var(--text-primary);
        }

        .nav-item.active {
            color: var(--accent);
        }

        .nav-icon {
            font-size: 20px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 500;
        }

        /* ===== AUTH MODAL ===== */
        .auth-modal {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 400px;
            overflow: hidden;
        }

        .auth-tabs {
            display: flex;
            background-color: var(--bg-card);
        }

        .auth-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .auth-tab.active {
            color: var(--accent);
            border-bottom: 3px solid var(--accent);
        }

        .auth-content {
            padding: 30px;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .auth-form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .auth-form-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .auth-form-input {
            padding: 12px 15px;
            background-color: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            color: var(--text-primary);
            font-size: 16px;
            transition: all var(--transition-fast);
        }

        .auth-form-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(229, 9, 20, 0.2);
        }

        .auth-submit-btn {
            padding: 15px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-top: 10px;
        }

        .auth-submit-btn:hover {
            background-color: var(--accent-light);
        }

        .google-auth-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .google-auth-btn:hover {
            background-color: #3367d6;
        }

        .auth-divider {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background-color: var(--border-color);
        }

        .auth-divider span {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* ===== TOAST NOTIFICATIONS ===== */
        .toast-container {
            position: fixed;
            bottom: calc(var(--nav-height) + 20px);
            right: 20px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .toast {
            background-color: var(--bg-card);
            border-left: 4px solid var(--accent);
            border-radius: var(--border-radius);
            padding: 15px 20px;
            box-shadow: var(--shadow-elevated);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideIn 0.3s ease;
            transform-origin: right bottom;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-icon {
            font-size: 20px;
            color: var(--accent);
        }

        .toast-message {
            flex: 1;
            font-size: 14px;
            color: var(--text-primary);
        }

        /* ===== FAVORITES SECTION ===== */
        .favorites-grid {
            min-height: 300px;
        }

        .empty-favorites {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 60px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .empty-description {
            max-width: 400px;
            margin: 0 auto 30px;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1024px) {
            :root {
                --header-height: 60px;
                --carousel-height: 320px;
            }
            
            .main-header {
                padding: 0 3%;
            }
            
            .carousel-section,
            .genre-section,
            .movies-section {
                padding: 0 3%;
            }
            
            .modal-title {
                font-size: 28px;
            }
        }

        @media (max-width: 768px) {
            :root {
                --carousel-height: 280px;
            }
            
            .logo span {
                display: none;
            }
            
            .search-container {
                max-width: 400px;
            }
            
            .carousel-title {
                font-size: 20px;
            }
            
            .carousel-overlay {
                padding: 20px;
            }
            
            .modal-body {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .modal-hero-content {
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            :root {
                --carousel-height: 240px;
                --header-height: 50px;
            }
            
            .header-actions .theme-toggle span {
                display: none;
            }
            
            .carousel-item {
                width: 80%;
            }
            
            .modal-actions {
                flex-direction: column;
            }
            
            .action-btn {
                width: 100%;
                justify-content: center;
            }
            
            .bottom-nav {
                height: 55px;
            }
            
            .nav-label {
                font-size: 10px;
            }
        }

        /* ===== ANIMATIONS ===== */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-up {
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* ===== SKELETON LOADING ===== */
        .skeleton {
            background: linear-gradient(90deg, var(--border-color) 25%, var(--bg-card) 50%, var(--border-color) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--border-radius);
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-card {
            aspect-ratio: 2/3;
            width: 100%;
        }

        .skeleton-text {
            height: 20px;
            margin-bottom: 10px;
        }

        .skeleton-text-sm {
            height: 16px;
            width: 60%;
        }

        /* ===== SCROLL PROGRESS ===== */
        .scroll-progress {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background-color: var(--accent);
            transform-origin: 0%;
            z-index: 999;
        }

        /* ===== CUSTOM CHECKBOX ===== */
        .custom-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .checkbox-box {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .checkbox-box.checked {
            background-color: var(--accent);
            border-color: var(--accent);
        }

        .checkbox-box.checked::after {
            content: '✓';
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-logo">
            <i class="fas fa-film"></i>
            <span>MOVIEBOX</span>
        </div>
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading your movie experience...</div>
    </div>

    <!-- Scroll Progress -->
    <div class="scroll-progress" id="scroll-progress"></div>

    <!-- Header -->
    <header class="main-header" id="main-header">
        <a href="#" class="logo">
            <i class="fas fa-film"></i>
            <span>MOVIEBOX</span>
        </a>
        
        <div class="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="Search movies...">
            <i class="fas fa-search search-icon"></i>
        </div>
        
        <div class="header-actions">
            <button class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon"></i>
                <span>Theme</span>
            </button>
            <div class="user-avatar" id="user-avatar">
                <i class="fas fa-user"></i>
            </div>
        </div>
    </header>

    <!-- 3D Carousel -->
    <section class="carousel-section">
        <h2 class="carousel-title">Trending Now</h2>
        <div class="carousel-container">
            <div class="carousel-track" id="carousel-track"></div>
            
            <div class="carousel-controls">
                <button class="carousel-btn" id="carousel-prev">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="carousel-btn" id="carousel-next">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <div class="carousel-indicators" id="carousel-indicators"></div>
        </div>
    </section>

    <!-- Genre Filters -->
    <section class="genre-section">
        <div class="genre-container" id="genre-container">
            <div class="genre-chip active" data-genre="all">All</div>
            <!-- Genre chips will be populated dynamically -->
        </div>
    </section>

    <!-- Movies Grid -->
    <section class="movies-section">
        <h2 class="section-title">
            <i class="fas fa-play-circle"></i>
            Recommended For You
        </h2>
        <div class="movies-grid" id="movies-grid">
            <!-- Movies will be populated dynamically -->
        </div>
    </section>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active" data-nav="home">
            <i class="fas fa-home nav-icon"></i>
            <span class="nav-label">Home</span>
        </a>
        <a href="#" class="nav-item" data-nav="search">
            <i class="fas fa-search nav-icon"></i>
            <span class="nav-label">Search</span>
        </a>
        <a href="#" class="nav-item" data-nav="favorites">
            <i class="fas fa-heart nav-icon"></i>
            <span class="nav-label">Favorites</span>
        </a>
        <a href="#" class="nav-item" data-nav="settings">
            <i class="fas fa-cog nav-icon"></i>
            <span class="nav-label">Settings</span>
        </a>
    </nav>

    <!-- Movie Detail Modal -->
    <div class="modal-backdrop" id="movie-modal">
        <div class="movie-modal">
            <button class="modal-close" id="movie-modal-close">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-content">
                <div class="modal-hero">
                    <img src="" alt="" class="modal-backdrop-image" id="modal-backdrop-image">
                    <div class="modal-hero-content">
                        <h1 class="modal-title" id="modal-title"></h1>
                        <div class="modal-meta">
                            <span class="modal-genre" id="modal-genre"></span>
                            <span class="modal-year" id="modal-year"></span>
                            <span class="modal-duration" id="modal-duration"></span>
                            <div class="modal-rating" id="modal-rating"></div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-body">
                    <div class="modal-main">
                        <p class="modal-description" id="modal-description"></p>
                        
                        <div class="modal-actions">
                            <button class="action-btn play-btn" id="play-btn">
                                <i class="fas fa-play"></i>
                                Play Now
                            </button>
                            <button class="action-btn download-btn" id="download-btn">
                                <i class="fas fa-download"></i>
                                Download
                            </button>
                            <button class="action-btn favorite-btn" id="favorite-btn">
                                <i class="fas fa-heart"></i>
                                Add to Favorites
                            </button>
                            <button class="action-btn report-btn" id="report-btn">
                                <i class="fas fa-flag"></i>
                                Report Broken Link
                            </button>
                        </div>
                        
                        <div class="rating-section">
                            <h3 class="rating-title">Rate this movie</h3>
                            <div class="star-rating" id="star-rating">
                                <span class="star" data-value="1">★</span>
                                <span class="star" data-value="2">★</span>
                                <span class="star" data-value="3">★</span>
                                <span class="star" data-value="4">★</span>
                                <span class="star" data-value="5">★</span>
                            </div>
                            <div id="rating-text">Click to rate</div>
                        </div>
                    </div>
                    
                    <div class="modal-sidebar">
                        <div class="info-item">
                            <div class="info-label">Stream Quality</div>
                            <div class="info-value">HD 1080p</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Audio</div>
                            <div class="info-value">English, Multiple</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Subtitles</div>
                            <div class="info-value">English, Spanish</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Added</div>
                            <div class="info-value" id="modal-added"></div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Views</div>
                            <div class="info-value" id="modal-views"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Player Modal -->
    <div class="modal-backdrop" id="video-modal">
        <div class="video-modal">
            <button class="modal-close video-close" id="video-modal-close">
                <i class="fas fa-times"></i>
            </button>
            <div class="video-container">
                <iframe class="video-iframe" id="video-iframe" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                </iframe>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-backdrop" id="settings-modal">
        <div class="settings-modal">
            <div class="settings-header">
                <h2 class="settings-title">Settings</h2>
                <p class="settings-subtitle">Customize your experience</p>
            </div>
            
            <div class="settings-content">
                <div class="settings-item">
                    <div class="settings-info">
                        <div class="settings-label">Dark Mode</div>
                        <div class="settings-description">Switch between dark and light theme</div>
                    </div>
                    <div class="toggle-switch" id="theme-toggle-switch">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                
                <div class="settings-item">
                    <div class="settings-info">
                        <div class="settings-label">Auto-play Videos</div>
                        <div class="settings-description">Automatically play next video</div>
                    </div>
                    <div class="toggle-switch" id="autoplay-toggle">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                
                <div class="settings-item">
                    <div class="settings-info">
                        <div class="settings-label">My Favorites</div>
                        <div class="settings-description" id="favorites-count">0 movies</div>
                    </div>
                    <button class="btn btn-outline" id="view-favorites-btn">View</button>
                </div>
                
                <div class="settings-item">
                    <div class="settings-info">
                        <div class="settings-label">Account</div>
                        <div class="settings-description" id="account-status">Not logged in</div>
                    </div>
                    <button class="btn btn-outline" id="account-btn">Login</button>
                </div>
                
                <div class="settings-item">
                    <div class="settings-info">
                        <div class="settings-label">App Version</div>
                        <div class="settings-description">MovieBox Streaming v2.0</div>
                    </div>
                </div>
            </div>
            
            <div class="settings-actions">
                <button class="btn btn-secondary" id="close-settings-btn">Close</button>
                <button class="btn btn-primary" id="save-settings-btn">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal-backdrop" id="auth-modal">
        <div class="auth-modal">
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Login</button>
                <button class="auth-tab" data-tab="signup">Sign Up</button>
            </div>
            
            <div class="auth-content">
                <form class="auth-form" id="login-form" style="display: block;">
                    <div class="auth-form-group">
                        <label class="auth-form-label">Email Address</label>
                        <input type="email" class="auth-form-input" id="login-email" placeholder="Enter your email" required>
                    </div>
                    
                    <div class="auth-form-group">
                        <label class="auth-form-label">Password</label>
                        <input type="password" class="auth-form-input" id="login-password" placeholder="Enter your password" required>
                    </div>
                    
                    <button type="submit" class="auth-submit-btn">Sign In</button>
                    
                    <div class="auth-divider">
                        <span>or continue with</span>
                    </div>
                    
                    <button type="button" class="google-auth-btn" id="google-login-btn">
                        <i class="fab fa-google"></i>
                        Sign in with Google
                    </button>
                </form>
                
                <form class="auth-form" id="signup-form" style="display: none;">
                    <div class="auth-form-group">
                        <label class="auth-form-label">Full Name</label>
                        <input type="text" class="auth-form-input" id="signup-name" placeholder="Enter your full name" required>
                    </div>
                    
                    <div class="auth-form-group">
                        <label class="auth-form-label">Email Address</label>
                        <input type="email" class="auth-form-input" id="signup-email" placeholder="Enter your email" required>
                    </div>
                    
                    <div class="auth-form-group">
                        <label class="auth-form-label">Password</label>
                        <input type="password" class="auth-form-input" id="signup-password" placeholder="Create a password" minlength="6" required>
                    </div>
                    
                    <div class="auth-form-group">
                        <label class="auth-form-label">Confirm Password</label>
                        <input type="password" class="auth-form-input" id="signup-confirm" placeholder="Confirm your password" required>
                    </div>
                    
                    <button type="submit" class="auth-submit-btn">Create Account</button>
                    
                    <div class="auth-divider">
                        <span>or sign up with</span>
                    </div>
                    
                    <button type="button" class="google-auth-btn" id="google-signup-btn">
                        <i class="fab fa-google"></i>
                        Sign up with Google
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyAwTb4dwTnLNwUZ_v37ht4xLL_buNOe96Q",
            authDomain: "mymovieapp-b088c.firebaseapp.com",
            projectId: "mymovieapp-b088c",
            storageBucket: "mymovieapp-b088c.firebasestorage.app",
            messagingSenderId: "243642474836",
            appId: "1:243642474836:web:69071fcd8b2ec9bd97a8c1"
        };

        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let firebaseApp;
        let firebaseAuth;
        let firebaseDB;
        
        let currentUser = null;
        let allMovies = [];
        let filteredMovies = [];
        let carouselMovies = [];
        let favorites = [];
        let genres = [];
        
        let currentMovie = null;
        let currentRating = 0;
        let carouselInterval = null;
        let currentCarouselIndex = 0;
        
        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Initializing MovieBox User Panel...');
            
            try {
                // Initialize Firebase
                await initializeFirebase();
                
                // Initialize UI
                initializeUI();
                
                // Load data
                await loadInitialData();
                
                // Hide loading screen
                setTimeout(() => {
                    document.getElementById('loading-screen').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loading-screen').style.display = 'none';
                    }, 300);
                }, 1000);
                
            } catch (error) {
                console.error('Initialization error:', error);
                showToast('Failed to initialize app. Please refresh.', 'error');
            }
        });

        async function initializeFirebase() {
            try {
                // Initialize Firebase
                firebaseApp = firebase.initializeApp(firebaseConfig);
                firebaseAuth = firebase.auth();
                firebaseDB = firebase.firestore();
                
                console.log('Firebase initialized successfully');
                
                // Set up auth state listener
                firebaseAuth.onAuthStateChanged((user) => {
                    currentUser = user;
                    updateAuthUI();
                    
                    if (user) {
                        console.log('User signed in:', user.email);
                        showToast(`Welcome ${user.displayName || user.email}!`, 'success');
                    }
                });
                
            } catch (error) {
                console.error('Firebase initialization error:', error);
                throw error;
            }
        }

        function initializeUI() {
            // Load theme
            loadTheme();
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize carousel
            initializeCarousel();
            
            // Set up scroll progress
            setupScrollProgress();
        }

        async function loadInitialData() {
            try {
                // Load movies from Firebase
                await loadMovies();
                
                // Extract genres
                extractGenres();
                
                // Setup genre filters
                setupGenreFilters();
                
                // Setup carousel
                setupCarousel();
                
                // Load favorites from localStorage
                loadFavorites();
                
                // Update UI
                updateFavoritesCount();
                
            } catch (error) {
                console.error('Error loading initial data:', error);
                showToast('Failed to load movies. Please try again.', 'error');
            }
        }

        // ============================================
        // FIREBASE DATA FUNCTIONS
        // ============================================
        async function loadMovies() {
            try {
                console.log('Loading movies from Firestore...');
                
                const snapshot = await firebaseDB.collection('movies').get();
                
                if (!snapshot.empty) {
                    allMovies = [];
                    snapshot.forEach((doc) => {
                        const movie = doc.data();
                        movie.id = doc.id;
                        
                        // Ensure all required fields exist
                        movie.title = movie.title || 'Untitled Movie';
                        movie.genre = movie.genre || 'Unknown';
                        movie.description = movie.description || 'No description available';
                        movie.posterUrl = movie.posterUrl || 'https://via.placeholder.com/300x450?text=No+Poster';
                        movie.movieUrl = movie.movieUrl || '';
                        movie.downloadUrl = movie.downloadUrl || '';
                        movie.year = movie.year || new Date().getFullYear();
                        movie.duration = movie.duration || 120;
                        movie.rating = movie.rating || 0;
                        movie.ratingCount = movie.ratingCount || 0;
                        movie.views = movie.views || 0;
                        movie.uploadDate = movie.uploadDate || Date.now();
                        
                        allMovies.push(movie);
                    });
                    
                    console.log(`Loaded ${allMovies.length} movies`);
                    
                    // Sort by upload date (newest first)
                    allMovies.sort((a, b) => b.uploadDate - a.uploadDate);
                    filteredMovies = [...allMovies];
                    
                    // Display movies
                    displayMovies(filteredMovies);
                    
                } else {
                    console.log('No movies found in Firestore');
                    showEmptyState();
                }
                
            } catch (error) {
                console.error('Error loading movies:', error);
                throw error;
            }
        }

        async function submitRating(movieId, rating) {
            if (!currentUser) {
                showToast('Please login to rate movies', 'warning');
                return;
            }
            
            try {
                const movieRef = firebaseDB.collection('movies').doc(movieId);
                const movieDoc = await movieRef.get();
                
                if (movieDoc.exists) {
                    const movie = movieDoc.data();
                    const currentRating = movie.rating || 0;
                    const currentCount = movie.ratingCount || 0;
                    
                    // Calculate new average rating
                    const newTotal = (currentRating * currentCount) + rating;
                    const newCount = currentCount + 1;
                    const newRating = newTotal / newCount;
                    
                    // Update movie
                    await movieRef.update({
                        rating: newRating,
                        ratingCount: newCount
                    });
                    
                    // Update local data
                    const movieIndex = allMovies.findIndex(m => m.id === movieId);
                    if (movieIndex !== -1) {
                        allMovies[movieIndex].rating = newRating;
                        allMovies[movieIndex].ratingCount = newCount;
                    }
                    
                    showToast('Rating submitted successfully!', 'success');
                    
                }
            } catch (error) {
                console.error('Error submitting rating:', error);
                showToast('Failed to submit rating', 'error');
            }
        }

        async function reportBrokenLink(movieId) {
            if (!currentUser) {
                showToast('Please login to report broken links', 'warning');
                return;
            }
            
            try {
                const movie = allMovies.find(m => m.id === movieId);
                if (!movie) return;
                
                const reportData = {
                    movieId: movieId,
                    movieTitle: movie.title,
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    timestamp: Date.now(),
                    status: 'pending'
                };
                
                // Add report to Firestore
                await firebaseDB.collection('reports').add(reportData);
                
                showToast('Broken link reported. Thank you!', 'success');
                
            } catch (error) {
                console.error('Error reporting broken link:', error);
                showToast('Failed to report broken link', 'error');
            }
        }

        async function incrementViews(movieId) {
            try {
                const movieRef = firebaseDB.collection('movies').doc(movieId);
                const movieDoc = await movieRef.get();
                
                if (movieDoc.exists) {
                    const currentViews = movieDoc.data().views || 0;
                    await movieRef.update({
                        views: currentViews + 1
                    });
                    
                    // Update local data
                    const movieIndex = allMovies.findIndex(m => m.id === movieId);
                    if (movieIndex !== -1) {
                        allMovies[movieIndex].views = currentViews + 1;
                    }
                }
            } catch (error) {
                console.error('Error incrementing views:', error);
            }
        }

        // ============================================
        // UI FUNCTIONS - MOVIES
        // ============================================
        function displayMovies(movies) {
            const moviesGrid = document.getElementById('movies-grid');
            
            if (movies.length === 0) {
                showEmptyState();
                return;
            }
            
            // Clear existing movies
            moviesGrid.innerHTML = '';
            
            // Display each movie
            movies.forEach(movie => {
                const movieCard = createMovieCard(movie);
                moviesGrid.appendChild(movieCard);
            });
        }

        function createMovieCard(movie) {
            const card = document.createElement('div');
            card.className = 'movie-card';
            card.setAttribute('data-id', movie.id);
            
            // Format rating
            const rating = movie.rating || 0;
            const ratingCount = movie.ratingCount || 0;
            const ratingText = rating > 0 ? `${rating.toFixed(1)} (${ratingCount})` : 'No ratings';
            
            card.innerHTML = `
                <img src="${movie.posterUrl}" 
                     alt="${movie.title}" 
                     class="movie-poster"
                     onerror="this.src='https://via.placeholder.com/300x450?text=Movie+Poster'">
                <div class="movie-overlay">
                    <h3 class="movie-title">${movie.title}</h3>
                    <div class="movie-meta">
                        <span>${movie.year || 'N/A'}</span>
                        <div class="movie-rating">
                            <i class="fas fa-star"></i>
                            <span>${ratingText}</span>
                        </div>
                    </div>
                    <span class="movie-genre-tag">${movie.genre}</span>
                </div>
            `;
            
            // Add click event
            card.addEventListener('click', () => openMovieDetail(movie.id));
            
            return card;
        }

        function showEmptyState() {
            const moviesGrid = document.getElementById('movies-grid');
            moviesGrid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
                    <div class="empty-icon">
                        <i class="fas fa-film"></i>
                    </div>
                    <h3 class="empty-title">No Movies Found</h3>
                    <p class="empty-description">
                        Try a different search or check back later for new additions.
                    </p>
                </div>
            `;
        }

        // ============================================
        // UI FUNCTIONS - MOVIE DETAIL
        // ============================================
        async function openMovieDetail(movieId) {
            const movie = allMovies.find(m => m.id === movieId);
            if (!movie) {
                showToast('Movie not found', 'error');
                return;
            }
            
            currentMovie = movie;
            
            // Increment views
            await incrementViews(movieId);
            
            // Update modal content
            updateMovieModal(movie);
            
            // Show modal
            document.getElementById('movie-modal').classList.add('active');
            
            // Reset rating
            currentRating = 0;
            updateStarRating();
        }

        function updateMovieModal(movie) {
            // Update hero image
            document.getElementById('modal-backdrop-image').src = movie.posterUrl;
            
            // Update title
            document.getElementById('modal-title').textContent = movie.title;
            
            // Update metadata
            document.getElementById('modal-genre').textContent = movie.genre;
            document.getElementById('modal-year').textContent = movie.year || 'N/A';
            document.getElementById('modal-duration').textContent = movie.duration ? `${movie.duration} min` : 'N/A';
            
            // Update rating
            const rating = movie.rating || 0;
            const ratingCount = movie.ratingCount || 0;
            const ratingHtml = rating > 0 
                ? `<i class="fas fa-star"></i> ${rating.toFixed(1)} (${ratingCount} votes)`
                : 'No ratings yet';
            document.getElementById('modal-rating').innerHTML = ratingHtml;
            
            // Update description
            document.getElementById('modal-description').textContent = movie.description || 'No description available.';
            
            // Update sidebar info
            const addedDate = new Date(movie.uploadDate || Date.now());
            document.getElementById('modal-added').textContent = addedDate.toLocaleDateString();
            document.getElementById('modal-views').textContent = (movie.views || 0).toLocaleString();
            
            // Update favorite button
            const isFavorited = favorites.includes(movie.id);
            const favoriteBtn = document.getElementById('favorite-btn');
            favoriteBtn.innerHTML = `<i class="fas fa-heart"></i> ${isFavorited ? 'Remove from Favorites' : 'Add to Favorites'}`;
            favoriteBtn.classList.toggle('favorited', isFavorited);
            
            // Update download button visibility
            const downloadBtn = document.getElementById('download-btn');
            downloadBtn.style.display = movie.downloadUrl ? 'flex' : 'none';
            
            // Update play button visibility
            const playBtn = document.getElementById('play-btn');
            playBtn.style.display = movie.movieUrl ? 'flex' : 'none';
        }

        // ============================================
        // UI FUNCTIONS - VIDEO PLAYER
        // ============================================
        function playMovie(movie) {
            if (!movie.movieUrl) {
                showToast('No video URL available for this movie', 'warning');
                return;
            }
            
            // Convert to embed URL if needed
            const embedUrl = convertToEmbedUrl(movie.movieUrl);
            
            // Update iframe
            const iframe = document.getElementById('video-iframe');
            iframe.src = embedUrl;
            
            // Close movie modal and open video modal
            document.getElementById('movie-modal').classList.remove('active');
            document.getElementById('video-modal').classList.add('active');
        }

        function convertToEmbedUrl(url) {
            if (!url) return '';
            
            // YouTube URL conversion
            if (url.includes('youtube.com/watch?v=')) {
                const videoId = url.split('v=')[1].split('&')[0];
                return `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1`;
            } else if (url.includes('youtu.be/')) {
                const videoId = url.split('youtu.be/')[1].split('?')[0];
                return `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1`;
            } else if (url.includes('vimeo.com/')) {
                const videoId = url.split('vimeo.com/')[1].split('?')[0];
                return `https://player.vimeo.com/video/${videoId}?autoplay=1&title=0&byline=0&portrait=0`;
            } else if (url.includes('dailymotion.com/video/')) {
                const videoId = url.split('dailymotion.com/video/')[1].split('_')[0];
                return `https://www.dailymotion.com/embed/video/${videoId}?autoplay=1`;
            }
            
            // For direct video URLs, return as-is (will play in HTML5 video player)
            return url;
        }

        // ============================================
        // UI FUNCTIONS - CAROUSEL
        // ============================================
        function initializeCarousel() {
            // Get carousel elements
            const track = document.getElementById('carousel-track');
            const prevBtn = document.getElementById('carousel-prev');
            const nextBtn = document.getElementById('carousel-next');
            
            // Set up event listeners
            prevBtn.addEventListener('click', () => navigateCarousel(-1));
            nextBtn.addEventListener('click', () => navigateCarousel(1));
            
            // Set up auto rotation
            startCarouselAutoRotation();
            
            // Pause on hover
            track.addEventListener('mouseenter', () => {
                clearInterval(carouselInterval);
            });
            
            track.addEventListener('mouseleave', () => {
                startCarouselAutoRotation();
            });
        }

        function setupCarousel() {
            // Get top 5 movies for carousel
            carouselMovies = allMovies.slice(0, 5);
            
            if (carouselMovies.length === 0) {
                document.querySelector('.carousel-container').style.display = 'none';
                return;
            }
            
            // Clear existing items
            const track = document.getElementById('carousel-track');
            const indicators = document.getElementById('carousel-indicators');
            track.innerHTML = '';
            indicators.innerHTML = '';
            
            // Create carousel items
            carouselMovies.forEach((movie, index) => {
                // Create carousel item
                const item = document.createElement('div');
                item.className = 'carousel-item';
                item.setAttribute('data-index', index);
                item.innerHTML = `
                    <img src="${movie.posterUrl}" alt="${movie.title}" class="carousel-image"
                         onerror="this.src='https://via.placeholder.com/800x450?text=Featured+Movie'">
                    <div class="carousel-overlay">
                        <h3 class="carousel-title">${movie.title}</h3>
                        <p class="carousel-description">${movie.description?.substring(0, 150) || 'Watch now on MovieBox'}...</p>
                        <button class="action-btn play-btn" style="background-color: white; color: black;">
                            <i class="fas fa-play"></i>
                            Watch Now
                        </button>
                    </div>
                `;
                
                // Add click event
                item.addEventListener('click', () => openMovieDetail(movie.id));
                
                track.appendChild(item);
                
                // Create indicator
                const indicator = document.createElement('div');
                indicator.className = 'carousel-indicator';
                indicator.setAttribute('data-index', index);
                indicator.addEventListener('click', () => goToCarouselSlide(index));
                indicators.appendChild(indicator);
            });
            
            // Set initial position
            goToCarouselSlide(0);
        }

        function navigateCarousel(direction) {
            const newIndex = (currentCarouselIndex + direction + carouselMovies.length) % carouselMovies.length;
            goToCarouselSlide(newIndex);
        }

        function goToCarouselSlide(index) {
            const items = document.querySelectorAll('.carousel-item');
            const indicators = document.querySelectorAll('.carousel-indicator');
            
            // Update current index
            currentCarouselIndex = index;
            
            // Update items
            items.forEach((item, i) => {
                item.classList.remove('active', 'left-1', 'left-2', 'right-1', 'right-2');
                
                if (i === index) {
                    item.classList.add('active');
                } else if (i === (index - 1 + items.length) % items.length) {
                    item.classList.add('left-1');
                } else if (i === (index - 2 + items.length) % items.length) {
                    item.classList.add('left-2');
                } else if (i === (index + 1) % items.length) {
                    item.classList.add('right-1');
                } else if (i === (index + 2) % items.length) {
                    item.classList.add('right-2');
                }
            });
            
            // Update indicators
            indicators.forEach((indicator, i) => {
                indicator.classList.toggle('active', i === index);
            });
        }

        function startCarouselAutoRotation() {
            clearInterval(carouselInterval);
            carouselInterval = setInterval(() => {
                navigateCarousel(1);
            }, 4000);
        }

        // ============================================
        // UI FUNCTIONS - GENRE FILTERS
        // ============================================
        function extractGenres() {
            const genreSet = new Set();
            
            allMovies.forEach(movie => {
                if (movie.genre) {
                    genreSet.add(movie.genre);
                }
            });
            
            genres = Array.from(genreSet).sort();
        }

        function setupGenreFilters() {
            const container = document.getElementById('genre-container');
            
            // Clear existing chips except "All"
            const allChip = container.querySelector('.genre-chip[data-genre="all"]');
            container.innerHTML = '';
            container.appendChild(allChip);
            
            // Add genre chips
            genres.forEach(genre => {
                const chip = document.createElement('div');
                chip.className = 'genre-chip';
                chip.setAttribute('data-genre', genre);
                chip.textContent = genre;
                chip.addEventListener('click', () => filterByGenre(genre));
                container.appendChild(chip);
            });
        }

        function filterByGenre(genre) {
            // Update active chip
            document.querySelectorAll('.genre-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            
            const activeChip = document.querySelector(`.genre-chip[data-genre="${genre}"]`);
            if (activeChip) {
                activeChip.classList.add('active');
            }
            
            // Filter movies
            if (genre === 'all') {
                filteredMovies = [...allMovies];
            } else {
                filteredMovies = allMovies.filter(movie => movie.genre === genre);
            }
            
            // Display filtered movies
            displayMovies(filteredMovies);
        }

        // ============================================
        // UI FUNCTIONS - FAVORITES
        // ============================================
        function loadFavorites() {
            const stored = localStorage.getItem('moviebox_favorites');
            favorites = stored ? JSON.parse(stored) : [];
        }

        function saveFavorites() {
            localStorage.setItem('moviebox_favorites', JSON.stringify(favorites));
            updateFavoritesCount();
        }

        function toggleFavorite(movieId) {
            const index = favorites.indexOf(movieId);
            
            if (index === -1) {
                // Add to favorites
                favorites.push(movieId);
                showToast('Added to favorites', 'success');
            } else {
                // Remove from favorites
                favorites.splice(index, 1);
                showToast('Removed from favorites', 'info');
            }
            
            saveFavorites();
            
            // Update UI if this movie is currently open
            if (currentMovie && currentMovie.id === movieId) {
                const favoriteBtn = document.getElementById('favorite-btn');
                const isFavorited = favorites.includes(movieId);
                favoriteBtn.innerHTML = `<i class="fas fa-heart"></i> ${isFavorited ? 'Remove from Favorites' : 'Add to Favorites'}`;
                favoriteBtn.classList.toggle('favorited', isFavorited);
            }
        }

        function updateFavoritesCount() {
            const countElement = document.getElementById('favorites-count');
            if (countElement) {
                countElement.textContent = `${favorites.length} ${favorites.length === 1 ? 'movie' : 'movies'}`;
            }
        }

        function showFavorites() {
            if (favorites.length === 0) {
                filteredMovies = [];
                displayMovies([]);
                return;
            }
            
            // Filter movies to show only favorites
            filteredMovies = allMovies.filter(movie => favorites.includes(movie.id));
            
            // Update section title
            document.querySelector('.section-title').innerHTML = `
                <i class="fas fa-heart"></i>
                My Favorites (${favorites.length})
            `;
            
            // Display favorites
            displayMovies(filteredMovies);
        }

        // ============================================
        // UI FUNCTIONS - SEARCH
        // ============================================
        function setupSearch() {
            const searchInput = document.getElementById('search-input');
            let searchTimeout;
            
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    performSearch(e.target.value);
                }, 300);
            });
            
            // Focus search when search nav item is clicked
            document.querySelector('.nav-item[data-nav="search"]').addEventListener('click', (e) => {
                e.preventDefault();
                searchInput.focus();
            });
        }

        function performSearch(query) {
            if (!query.trim()) {
                // Reset to current genre filter
                const activeGenre = document.querySelector('.genre-chip.active').dataset.genre;
                filterByGenre(activeGenre);
                return;
            }
            
            const searchTerm = query.toLowerCase();
            
            // Search in title, genre, and description
            filteredMovies = allMovies.filter(movie => {
                return (
                    movie.title.toLowerCase().includes(searchTerm) ||
                    movie.genre.toLowerCase().includes(searchTerm) ||
                    (movie.description && movie.description.toLowerCase().includes(searchTerm))
                );
            });
            
            // Update section title
            document.querySelector('.section-title').innerHTML = `
                <i class="fas fa-search"></i>
                Search Results for "${query}"
            `;
            
            // Display results
            displayMovies(filteredMovies);
        }

        // ============================================
        // UI FUNCTIONS - RATING SYSTEM
        // ============================================
        function setupRatingSystem() {
            const stars = document.querySelectorAll('.star');
            
            stars.forEach(star => {
                star.addEventListener('click', (e) => {
                    const value = parseInt(e.target.dataset.value);
                    setRating(value);
                });
                
                star.addEventListener('mouseover', (e) => {
                    const value = parseInt(e.target.dataset.value);
                    highlightStars(value);
                });
            });
            
            // Reset on mouse leave
            document.getElementById('star-rating').addEventListener('mouseleave', () => {
                highlightStars(currentRating);
            });
        }

        function setRating(value) {
            if (!currentUser) {
                showToast('Please login to rate movies', 'warning');
                return;
            }
            
            currentRating = value;
            updateStarRating();
            
            // Submit rating to Firebase
            if (currentMovie) {
                submitRating(currentMovie.id, value);
            }
        }

        function highlightStars(value) {
            const stars = document.querySelectorAll('.star');
            const ratingText = document.getElementById('rating-text');
            
            stars.forEach(star => {
                const starValue = parseInt(star.dataset.value);
                star.classList.toggle('active', starValue <= value);
            });
            
            // Update rating text
            ratingText.textContent = value > 0 ? `Rating: ${value} star${value === 1 ? '' : 's'}` : 'Click to rate';
        }

        function updateStarRating() {
            highlightStars(currentRating);
        }

        // ============================================
        // UI FUNCTIONS - THEME
        // ============================================
        function loadTheme() {
            const savedTheme = localStorage.getItem('moviebox_theme') || 'dark';
            
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
                document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-sun"></i><span>Light</span>';
                document.getElementById('theme-toggle-switch').classList.add('active');
            } else {
                document.body.classList.remove('light-theme');
                document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-moon"></i><span>Dark</span>';
                document.getElementById('theme-toggle-switch').classList.remove('active');
            }
        }

        function toggleTheme() {
            if (document.body.classList.contains('light-theme')) {
                // Switch to dark
                document.body.classList.remove('light-theme');
                localStorage.setItem('moviebox_theme', 'dark');
                document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-moon"></i><span>Dark</span>';
                document.getElementById('theme-toggle-switch').classList.remove('active');
                showToast('Switched to dark theme', 'info');
            } else {
                // Switch to light
                document.body.classList.add('light-theme');
                localStorage.setItem('moviebox_theme', 'light');
                document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-sun"></i><span>Light</span>';
                document.getElementById('theme-toggle-switch').classList.add('active');
                showToast('Switched to light theme', 'info');
            }
        }

        // ============================================
        // UI FUNCTIONS - AUTHENTICATION
        // ============================================
        function updateAuthUI() {
            const avatar = document.getElementById('user-avatar');
            const accountStatus = document.getElementById('account-status');
            const accountBtn = document.getElementById('account-btn');
            
            if (currentUser) {
                // User is logged in
                const displayName = currentUser.displayName || currentUser.email.split('@')[0];
                avatar.innerHTML = displayName.charAt(0).toUpperCase();
                avatar.title = currentUser.email;
                
                if (accountStatus) accountStatus.textContent = currentUser.email;
                if (accountBtn) accountBtn.textContent = 'Logout';
            } else {
                // User is not logged in
                avatar.innerHTML = '<i class="fas fa-user"></i>';
                avatar.title = 'Login';
                
                if (accountStatus) accountStatus.textContent = 'Not logged in';
                if (accountBtn) accountBtn.textContent = 'Login';
            }
        }

        async function handleGoogleLogin() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('profile');
                provider.addScope('email');
                
                const result = await firebaseAuth.signInWithPopup(provider);
                console.log('Google login successful:', result.user);
                
                // Close auth modal
                closeModal('auth-modal');
                
                showToast('Successfully logged in with Google!', 'success');
                
            } catch (error) {
                console.error('Google login error:', error);
                showToast('Google login failed. Please try again.', 'error');
            }
        }

        async function handleEmailLogin(email, password) {
            try {
                await firebaseAuth.signInWithEmailAndPassword(email, password);
                console.log('Email login successful');
                
                // Close auth modal
                closeModal('auth-modal');
                
                showToast('Successfully logged in!', 'success');
                
            } catch (error) {
                console.error('Email login error:', error);
                
                if (error.code === 'auth/user-not-found') {
                    showToast('User not found. Please sign up first.', 'warning');
                } else if (error.code === 'auth/wrong-password') {
                    showToast('Incorrect password. Please try again.', 'error');
                } else {
                    showToast('Login failed. Please try again.', 'error');
                }
            }
        }

        async function handleEmailSignup(name, email, password) {
            try {
                // Create user
                const userCredential = await firebaseAuth.createUserWithEmailAndPassword(email, password);
                
                // Update profile with name
                await userCredential.user.updateProfile({
                    displayName: name
                });
                
                console.log('Email signup successful');
                
                // Close auth modal
                closeModal('auth-modal');
                
                showToast('Account created successfully!', 'success');
                
            } catch (error) {
                console.error('Email signup error:', error);
                
                if (error.code === 'auth/email-already-in-use') {
                    showToast('Email already in use. Please login instead.', 'warning');
                } else if (error.code === 'auth/weak-password') {
                    showToast('Password should be at least 6 characters.', 'warning');
                } else {
                    showToast('Signup failed. Please try again.', 'error');
                }
            }
        }

        async function handleLogout() {
            try {
                await firebaseAuth.signOut();
                showToast('Successfully logged out', 'info');
            } catch (error) {
                console.error('Logout error:', error);
                showToast('Logout failed. Please try again.', 'error');
            }
        }

        // ============================================
        // UI FUNCTIONS - MODALS
        // ============================================
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            
            // Special handling for video modal
            if (modalId === 'video-modal') {
                const iframe = document.getElementById('video-iframe');
                iframe.src = '';
            }
        }

        // ============================================
        // UI FUNCTIONS - TOAST NOTIFICATIONS
        // ============================================
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            
            // Set icon based on type
            let icon = 'fa-info-circle';
            if (type === 'success') icon = 'fa-check-circle';
            if (type === 'error') icon = 'fa-exclamation-circle';
            if (type === 'warning') icon = 'fa-exclamation-triangle';
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="toast-message">${message}</div>
            `;
            
            container.appendChild(toast);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (toast.parentElement) {
                            toast.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }

        // ============================================
        // UI FUNCTIONS - SCROLL PROGRESS
        // ============================================
        function setupScrollProgress() {
            const progressBar = document.getElementById('scroll-progress');
            
            window.addEventListener('scroll', () => {
                const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
                const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrolled = (winScroll / height) * 100;
                progressBar.style.transform = `scaleX(${scrolled / 100})`;
                
                // Update header background
                const header = document.getElementById('main-header');
                if (winScroll > 100) {
                    header.classList.add('header-scrolled');
                } else {
                    header.classList.remove('header-scrolled');
                }
            });
        }

        // ============================================
        // EVENT LISTENERS SETUP
        // ============================================
        function setupEventListeners() {
            // Theme toggle
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
            document.getElementById('theme-toggle-switch').addEventListener('click', toggleTheme);
            
            // Search
            setupSearch();
            
            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active nav
                    document.querySelectorAll('.nav-item').forEach(nav => {
                        nav.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Handle navigation
                    const navType = this.dataset.nav;
                    handleNavigation(navType);
                });
            });
            
            // Movie modal
            document.getElementById('movie-modal-close').addEventListener('click', () => {
                closeModal('movie-modal');
            });
            
            // Video modal
            document.getElementById('video-modal-close').addEventListener('click', () => {
                closeModal('video-modal');
            });
            
            // Movie actions
            document.getElementById('play-btn').addEventListener('click', () => {
                if (currentMovie) {
                    playMovie(currentMovie);
                }
            });
            
            document.getElementById('download-btn').addEventListener('click', () => {
                if (currentMovie && currentMovie.downloadUrl) {
                    window.open(currentMovie.downloadUrl, '_blank');
                    showToast('Download started', 'info');
                }
            });
            
            document.getElementById('favorite-btn').addEventListener('click', () => {
                if (currentMovie) {
                    toggleFavorite(currentMovie.id);
                }
            });
            
            document.getElementById('report-btn').addEventListener('click', () => {
                if (currentMovie) {
                    reportBrokenLink(currentMovie.id);
                }
            });
            
            // Rating system
            setupRatingSystem();
            
            // Settings modal
            document.querySelector('.nav-item[data-nav="settings"]').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('settings-modal').classList.add('active');
            });
            
            document.getElementById('close-settings-btn').addEventListener('click', () => {
                closeModal('settings-modal');
            });
            
            document.getElementById('save-settings-btn').addEventListener('click', () => {
                // Save settings to localStorage
                const autoplay = document.getElementById('autoplay-toggle').classList.contains('active');
                localStorage.setItem('moviebox_autoplay', autoplay);
                
                showToast('Settings saved', 'success');
                closeModal('settings-modal');
            });
            
            document.getElementById('view-favorites-btn').addEventListener('click', () => {
                closeModal('settings-modal');
                showFavorites();
                
                // Update navigation
                document.querySelectorAll('.nav-item').forEach(nav => {
                    nav.classList.remove('active');
                });
                document.querySelector('.nav-item[data-nav="favorites"]').classList.add('active');
            });
            
            // Auth
            document.getElementById('user-avatar').addEventListener('click', () => {
                if (currentUser) {
                    // Show user menu or logout
                    handleLogout();
                } else {
                    // Show auth modal
                    document.getElementById('auth-modal').classList.add('active');
                }
            });
            
            document.getElementById('account-btn').addEventListener('click', () => {
                if (currentUser) {
                    handleLogout();
                    closeModal('settings-modal');
                } else {
                    closeModal('settings-modal');
                    document.getElementById('auth-modal').classList.add('active');
                }
            });
            
            // Auth tabs
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabType = this.dataset.tab;
                    
                    // Update active tab
                    document.querySelectorAll('.auth-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Show correct form
                    document.getElementById('login-form').style.display = tabType === 'login' ? 'block' : 'none';
                    document.getElementById('signup-form').style.display = tabType === 'signup' ? 'block' : 'none';
                });
            });
            
            // Google auth buttons
            document.getElementById('google-login-btn').addEventListener('click', handleGoogleLogin);
            document.getElementById('google-signup-btn').addEventListener('click', handleGoogleLogin);
            
            // Email login form
            document.getElementById('login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                await handleEmailLogin(email, password);
            });
            
            // Email signup form
            document.getElementById('signup-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('signup-name').value;
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                const confirm = document.getElementById('signup-confirm').value;
                
                // Validate password match
                if (password !== confirm) {
                    showToast('Passwords do not match', 'error');
                    return;
                }
                
                await handleEmailSignup(name, email, password);
            });
            
            // Close modals on backdrop click
            document.querySelectorAll('.modal-backdrop').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                        
                        // Special handling for video modal
                        if (this.id === 'video-modal') {
                            const iframe = document.getElementById('video-iframe');
                            iframe.src = '';
                        }
                    }
                });
            });
            
            // Close modals on Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal-backdrop.active').forEach(modal => {
                        modal.classList.remove('active');
                        
                        // Special handling for video modal
                        if (modal.id === 'video-modal') {
                            const iframe = document.getElementById('video-iframe');
                            iframe.src = '';
                        }
                    });
                }
            });
            
            // Load autoplay setting
            const autoplay = localStorage.getItem('moviebox_autoplay') === 'true';
            if (autoplay) {
                document.getElementById('autoplay-toggle').classList.add('active');
            }
        }

        function handleNavigation(navType) {
            switch(navType) {
                case 'home':
                    // Reset to home view
                    filteredMovies = [...allMovies];
                    displayMovies(filteredMovies);
                    document.querySelector('.section-title').innerHTML = `
                        <i class="fas fa-play-circle"></i>
                        Recommended For You
                    `;
                    break;
                    
                case 'search':
                    // Focus search input
                    document.getElementById('search-input').focus();
                    break;
                    
                case 'favorites':
                    showFavorites();
                    break;
                    
                case 'settings':
                    // Settings modal is handled separately
                    break;
            }
        }
    </script>
</body>
</html>
